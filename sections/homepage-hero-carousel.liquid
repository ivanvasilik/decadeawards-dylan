{%- comment -%}
  Homepage Hero Carousel - Decade Awards
  A modern, full-width slideshow with elegant transitions
{%- endcomment -%}

{{ 'section-homepage-hero.css' | asset_url | stylesheet_tag }}

<section class="da-hero" aria-label="Featured promotions">
  <div class="da-hero__carousel" data-carousel>
    {%- for block in section.blocks -%}
      <div
        class="da-hero__slide {% if forloop.first %}da-hero__slide--active{% endif %}"
        data-slide="{{ forloop.index0 }}"
        {{ block.shopify_attributes }}
      >
        {%- if block.settings.image != blank -%}
          <img
            src="{{ block.settings.image | image_url: width: 1920 }}"
            srcset="{{ block.settings.image | image_url: width: 800 }} 800w,
                    {{ block.settings.image | image_url: width: 1200 }} 1200w,
                    {{ block.settings.image | image_url: width: 1920 }} 1920w"
            sizes="100vw"
            alt="{{ block.settings.image.alt | default: block.settings.heading }}"
            class="da-hero__image"
            loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            fetchpriority="{% if forloop.first %}high{% else %}low{% endif %}"
          >
        {%- else -%}
          <div class="da-hero__placeholder">
            {{ 'lifestyle-1' | placeholder_svg_tag: 'da-hero__placeholder-svg' }}
          </div>
        {%- endif -%}

        <div class="da-hero__overlay"></div>

        <div class="da-hero__content da-hero__content--{{ block.settings.text_position }}">
          <div class="da-hero__content-inner">
            {%- if block.settings.subheading != blank -%}
              <span class="da-hero__subheading">{{ block.settings.subheading }}</span>
            {%- endif -%}
            {%- if block.settings.heading != blank -%}
              <h2 class="da-hero__heading">{{ block.settings.heading }}</h2>
            {%- endif -%}
            {%- if block.settings.text != blank -%}
              <p class="da-hero__text">{{ block.settings.text }}</p>
            {%- endif -%}
            {%- if block.settings.button_label != blank -%}
              <a href="{{ block.settings.button_link }}" class="da-hero__button">
                <span>{{ block.settings.button_label }}</span>
                <svg class="da-hero__button-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </a>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endfor -%}

    {%- if section.blocks.size > 1 -%}
      <div class="da-hero__nav">
        <button class="da-hero__nav-btn da-hero__nav-btn--prev" aria-label="Previous slide" data-prev>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="da-hero__dots" role="tablist">
          {%- for block in section.blocks -%}
            <button
              class="da-hero__dot {% if forloop.first %}da-hero__dot--active{% endif %}"
              data-dot="{{ forloop.index0 }}"
              role="tab"
              aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
              aria-label="Go to slide {{ forloop.index }}"
            ></button>
          {%- endfor -%}
        </div>
        <button class="da-hero__nav-btn da-hero__nav-btn--next" aria-label="Next slide" data-next>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('[data-carousel]');
    if (!carousel) return;

    const slides = carousel.querySelectorAll('[data-slide]');
    const dots = carousel.querySelectorAll('[data-dot]');
    const prevBtn = carousel.querySelector('[data-prev]');
    const nextBtn = carousel.querySelector('[data-next]');
    let currentSlide = 0;
    let autoplayInterval;

    function goToSlide(index) {
      slides[currentSlide].classList.remove('da-hero__slide--active');
      dots[currentSlide]?.classList.remove('da-hero__dot--active');
      dots[currentSlide]?.setAttribute('aria-selected', 'false');

      currentSlide = (index + slides.length) % slides.length;

      slides[currentSlide].classList.add('da-hero__slide--active');
      dots[currentSlide]?.classList.add('da-hero__dot--active');
      dots[currentSlide]?.setAttribute('aria-selected', 'true');
    }

    function nextSlide() { goToSlide(currentSlide + 1); }
    function prevSlide() { goToSlide(currentSlide - 1); }

    function startAutoplay() {
      autoplayInterval = setInterval(nextSlide, {{ section.settings.autoplay_speed | default: 5000 }});
    }

    function stopAutoplay() {
      clearInterval(autoplayInterval);
    }

    prevBtn?.addEventListener('click', () => { stopAutoplay(); prevSlide(); startAutoplay(); });
    nextBtn?.addEventListener('click', () => { stopAutoplay(); nextSlide(); startAutoplay(); });
    dots.forEach((dot, i) => {
      dot.addEventListener('click', () => { stopAutoplay(); goToSlide(i); startAutoplay(); });
    });

    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);

    {% if section.settings.autoplay %}startAutoplay();{% endif %}
  });
</script>

{% schema %}
{
  "name": "Hero Carousel",
  "tag": "section",
  "class": "section-hero-carousel",
  "max_blocks": 5,
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Slide duration (ms)",
      "min": 3000,
      "max": 8000,
      "step": 1000,
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Featured Collection"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Trophies & Awards"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Text position",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Carousel",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "heading": "Trophies & Awards",
            "subheading": "Celebrate Every Achievement",
            "text": "Premium quality trophies with free engraving",
            "button_label": "Shop Now"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Medals Collection",
            "subheading": "Wide Variety Available",
            "text": "All with free engraving included",
            "button_label": "Shop Now"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Personalized Gifts",
            "subheading": "Make It Special",
            "text": "Custom glassware and gift items",
            "button_label": "Explore Now"
          }
        }
      ]
    }
  ]
}
{% endschema %}
